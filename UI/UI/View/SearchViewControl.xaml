<UserControl x:Class="Sando.UI.View.SearchViewControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:vsfx="clr-namespace:Microsoft.VisualStudio.Shell;assembly=Microsoft.VisualStudio.Shell.10.0"
             xmlns:SearchEngine="clr-namespace:Sando.SearchEngine;assembly=SearchEngine"
             xmlns:local="clr-namespace:Sando.UI" xmlns:view="clr-namespace:Sando.UI.View" mc:Ignorable="d" 
             xmlns:ExContract="clr-namespace:Sando.ExtensionContracts.ProgramElementContracts;assembly=SandoExtensionContracts"
             d:DesignWidth="700" d:DesignHeight="400"
             Name="MyToolWindow"
             Background="{DynamicResource {x:Static vsfx:VsBrushes.ToolWindowBackgroundKey}}">
    <UserControl.Resources>
        <view:ElementToIcon x:Key="ElementToIcon"/>
        <view:FileTypeToIcon x:Key="FileTypeToIcon"/>
		<view:NullableBoolToBool x:Key="NullableBoolToBool"/>
		<view:NullOrEmptyIsHidden x:Key="NullOrEmptyIsHidden"/>
		<view:NullOrEmptyToVisibility x:Key="NullOrEmptyToVisibility"/>
		
        <ObjectDataProvider x:Key="ProgramElementType" MethodName="GetValues" ObjectType="{x:Type ExContract:ProgramElementType}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="ExContract:ProgramElementType"/>
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>
		<ObjectDataProvider x:Key="AccessLevel" MethodName="GetValues" ObjectType="{x:Type ExContract:AccessLevel}">
			<ObjectDataProvider.MethodParameters>
				<x:Type TypeName="ExContract:AccessLevel"/>
			</ObjectDataProvider.MethodParameters>
		</ObjectDataProvider>
	</UserControl.Resources>
    
    <Grid VerticalAlignment="Top" HorizontalAlignment="Left">
        <Grid.RowDefinitions>
            <RowDefinition MinHeight="200" Height="*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition MinWidth="250" Width="2*"/>
            <ColumnDefinition MinWidth="0" Width="0"/>
            <ColumnDefinition MinWidth="300" Width="5*"/>
        </Grid.ColumnDefinitions>
        <Grid.Resources></Grid.Resources>

        <!--Left Part: Query-->
        <GroupBox Margin="5">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" MinHeight="100"/>
                    <RowDefinition Height="Auto" MinHeight="30"/>
                </Grid.RowDefinitions>
                <StackPanel Grid.Row="0" Height="Auto">
                    <!--Query String Input-->
                    <TextBlock Margin="5,0,5,5" Text="Find:"/>
                    <StackPanel Margin="5,0,5,5" >
                        <StackPanel.Resources>
                            <Style TargetType="{x:Type StackPanel}">
                                <Setter Property="Margin" Value="0,5,0,0"/>
                            </Style>
                        </StackPanel.Resources>
                        <TextBox  Grid.Column="0" Height="25" KeyDown="OnKeyDownHandler" BorderThickness="1" BorderBrush="DimGray" Text="{Binding Path=SearchString}"
								  KeyboardNavigation.IsTabStop="True" KeyboardNavigation.TabIndex="10"></TextBox>
                    </StackPanel>

					<!--Where to query?
					<TextBlock Margin="5,0,5,0" Text="Where?"/>
                    <ComboBox Margin="5,0,5,5" SelectedIndex="0" >
                        <ComboBoxItem Content="{Binding Path=ComboBoxItemCurrentDocument}"/>
                        <ComboBoxItem Content="{Binding Path=ComboBoxItemEntireSolution}" />
                    </ComboBox>
					-->
					<!--What element type??-->
					<Grid>
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="Auto"/>
							<ColumnDefinition Width="*"/>
						</Grid.ColumnDefinitions>
						<TextBlock Margin="5,0,5,5" Text="Access level:" Grid.Column="0"/>
						<CheckBox Name="searchByAccessLevel" HorizontalAlignment="Left" Margin="5,2,5,5" Grid.Column="1" IsChecked="False"
								  KeyboardNavigation.IsTabStop="True" KeyboardNavigation.TabIndex="20"/>
					</Grid>
					<ComboBox Name="searchAccessLevel" IsEnabled="{Binding ElementName=searchByAccessLevel, Path=IsChecked}" Margin="5,0,5,5" SelectedIndex="0" ItemsSource="{Binding Source={StaticResource ResourceKey=AccessLevel}}"
							  KeyboardNavigation.IsTabStop="{Binding ElementName=searchByAccessLevel,Path=IsChecked}" KeyboardNavigation.TabIndex="30"/>

                    <!--What element type??-->
					<Grid>
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="Auto"/>
							<ColumnDefinition Width="*"/>
						</Grid.ColumnDefinitions>
						<TextBlock Margin="5,0,5,5" Text="Element type:" Grid.Column="0"/>
						<CheckBox Name="searchByProgramElementType" HorizontalAlignment="Left" Margin="5,2,5,5" Grid.Column="1" IsChecked="False" 
								  KeyboardNavigation.IsTabStop="True" KeyboardNavigation.TabIndex="40"/>
					</Grid>
					<ComboBox Name="searchElementType" IsEnabled="{Binding ElementName=searchByProgramElementType, Path=IsChecked}" Margin="5,0,5,5" SelectedIndex="0" 
							  ItemsSource="{Binding Source={StaticResource ResourceKey=ProgramElementType}}"
							  KeyboardNavigation.IsTabStop="{Binding ElementName=searchByProgramElementType,Path=IsChecked}" KeyboardNavigation.TabIndex="50"/>

				</StackPanel>
                <Button Grid.Row="1" Margin="0,0,5,0" Content="{Binding Path=SearchLabel}" HorizontalAlignment="Right" Width="60" Height="25" Name="searchButton" Click="SearchButtonClick" 
						KeyboardNavigation.IsTabStop="True" KeyboardNavigation.TabIndex="60"/>
            </Grid>
        </GroupBox>

        <!--Right Part: Result-->
        <Expander Name="resultExpander" Grid.Row="0" Grid.Column="2" ExpandDirection="Right" Header="" IsExpanded="False" VerticalContentAlignment="Stretch" HorizontalContentAlignment="Stretch">
            
            <ListView Name="searchResultListbox" ItemsSource="{Binding Path=SearchResults}" ScrollViewer.VerticalScrollBarVisibility="Visible"
                Margin="5,5,5,5" SelectedIndex="0" HorizontalAlignment="Stretch" VerticalContentAlignment="Top" 
					  KeyboardNavigation.IsTabStop="False" VerticalAlignment="Stretch" MinWidth="300" MinHeight="100">
                <ListView.ItemContainerStyle>
                    <Style TargetType="ListViewItem">
                        <Setter Property="HorizontalContentAlignment"                            
                Value="Stretch" />
                        <Setter Property="Margin" Value="0,0,0,0"/>
                        <Setter Property="Padding" Value="0,0,0,0"/>
                        <EventSetter Event="MouseDoubleClick" Handler="UIElement_OnMouseDown"/>
                        <EventSetter Event="KeyDown" Handler="UIElement_OnKeyDown"/>
                    </Style>
                </ListView.ItemContainerStyle>
                <ListView.View>
                    <GridView>
						<GridViewColumn Width="330" Header="Code Snippet">
							<GridViewColumn.CellTemplate>
								<DataTemplate>
									<Grid Margin="0,2,0,0">
										<Grid.RowDefinitions>
											<RowDefinition Height="{Binding ElementName=Parent, Path=Text.Length, Converter={StaticResource NullOrEmptyIsHidden}}"/>
											<RowDefinition Height="1"/>
											<RowDefinition Height="60"/>
											<RowDefinition Height="0" />
										</Grid.RowDefinitions>
										<Grid.ColumnDefinitions>
											<ColumnDefinition Width="*"/>
										</Grid.ColumnDefinitions>
										<Grid Grid.Row="0" Grid.Column="0">
											<Grid.ColumnDefinitions>
												<ColumnDefinition Width="70"/>
												<ColumnDefinition Width="20"/>
												<ColumnDefinition Width="Auto"/>
											</Grid.ColumnDefinitions>
											<Grid.RowDefinitions>
												<RowDefinition Height="20"/>
												<RowDefinition Height="20"/>												
											</Grid.RowDefinitions>
											<Image Source="{Binding Mode=OneWay, Path=Element, Converter={StaticResource ElementToIcon}}" Width="16" Height="16" Margin="2,2,2,2" Grid.Row="0" Grid.Column="1" />
											<Image Source="{Binding Mode=OneWay, Path=Element, Converter={StaticResource ElementToIcon}}" Width="16" Height="16" Margin="2,2,2,2" Grid.Row="1" Grid.Column="1" Visibility="{Binding ElementName=Parent, Path=Text.Length, Converter={StaticResource NullOrEmptyToVisibility}}" DataContext="{Binding}" />
											<!--<Image Source="{Binding Mode=OneWay, Path=Element.FullFilePath, Converter={StaticResource FileTypeToIcon}}" Width="20" Height="20" Grid.Row="2" Grid.Column="0" />-->

											<TextBlock Name="Type" Text="{Binding Mode=OneWay, Path=Type}" TextTrimming="WordEllipsis" Grid.Row="0" Grid.Column="0" />
											<TextBlock Name="Name" Text="{Binding Mode=OneWay, Path=Name}" TextTrimming="WordEllipsis" Grid.Row="0" Grid.Column="2" FontWeight="Bold" />
											<TextBlock Text="Parent:" Grid.Row="1" Grid.Column="0"  Visibility="{Binding ElementName=Parent, Path=Text.Length, Converter={StaticResource ResourceKey=NullOrEmptyToVisibility}}" DataContext="{Binding}" />
											<TextBlock Name="Parent" Text="{Binding Mode=OneWay, Path=Parent}" TextTrimming="WordEllipsis" Grid.Row="1" Grid.Column="2" />
										</Grid>
										<Canvas Width="Auto" Height="0" Margin="-5,0,0,0" Grid.Row="1" Grid.Column="0">
											<Line X1="1" X2="1000" Y1="0" Y2="0" Stroke="LightSlateGray" StrokeThickness="1"></Line>
										</Canvas>
										<TextBlock Margin="5,2,0,0" FontFamily="Consolas" MinWidth="200" FontSize="9" TextAlignment="Left" VerticalAlignment="Top" Width="Auto" Height="60" 
                                               Text="{Binding Mode=OneWay, Path=Snippet}" Grid.Row="2" Grid.Column="0" TextTrimming="CharacterEllipsis"/>
										<Canvas Width="Auto" Height="0" Margin="-5,0,0,0" Grid.Row="3" Grid.Column="0">
											<Line X1="1" X2="1000" Y1="0" Y2="0" Stroke="LightSlateGray" StrokeThickness="1"></Line>
										</Canvas>
									</Grid>
								</DataTemplate>
							</GridViewColumn.CellTemplate>
						</GridViewColumn>
						<!--
                        <GridViewColumn  Header="Summary" Width="125" >
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <Grid Margin="0,2,0,0">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="20" />
                                            <RowDefinition Height="20" />
                                            <RowDefinition Height="20" />
                                            <RowDefinition Height="0" />
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Name="Icon" Width="20"/>
                                            <ColumnDefinition Name="Summary" Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Name="Name" Text="{Binding Mode=OneWay, Path=Name}" Width="{Binding ElementName=Summary, Path=Width}" TextTrimming="WordEllipsis" Grid.Row="0" Grid.Column="1" />
                                        <TextBlock Name="Parent" Text="{Binding Mode=OneWay, Path=Parent}" Width="{Binding ElementName=Summary, Path=Width}" TextTrimming="WordEllipsis" Grid.Row="1" Grid.Column="1" />
                                        <TextBlock Name="FileName" Text="{Binding Mode=OneWay, Path=FileName}" Width="{Binding ElementName=Summary, Path=Width}" TextTrimming="WordEllipsis" Grid.Row="2" Grid.Column="1" />
                                        <Canvas HorizontalAlignment="Stretch" Height="0" Margin="0,0,0,0" Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2">
                                            <Line X1="1" X2="600" Y1="0" Y2="0" Stroke="LightSlateGray" StrokeThickness="1" />
                                        </Canvas>
                                        <Image Source="{Binding Mode=OneWay, Path=Element, Converter={StaticResource ElementToIcon}}" Width="16" Height="16" Margin="2,2,2,2" Grid.Row="0" Grid.Column="0" />
                                        <Image Source="{Binding Mode=OneWay, Path=Element.FullFilePath, Converter={StaticResource FileTypeToIcon}}" Width="20" Height="20" Grid.Row="2" Grid.Column="0" />

                                    </Grid>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn Width="330" Header="Code Snippet">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <Grid Margin="0,2,0,0">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="60" />
                                            <RowDefinition Height="0" />
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Margin="5,2,0,0" FontFamily="Consolas" MinWidth="200" FontSize="9" TextAlignment="Left" VerticalAlignment="Top" Width="Auto" Height="60" 
                                               Text="{Binding Mode=OneWay, Path=Snippet}" Grid.Row="0" Grid.Column="1" TextTrimming="CharacterEllipsis"/>
                                        <Canvas Width="Auto" Height="0" Margin="-5,0,0,0" Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2">
                                            <Line X1="1" X2="1000" Y1="0" Y2="0" Stroke="LightSlateGray" StrokeThickness="1"></Line>
                                        </Canvas>
                                    </Grid>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>-->
                    </GridView>
                </ListView.View>
            </ListView>
        </Expander>
    </Grid>
</UserControl>
